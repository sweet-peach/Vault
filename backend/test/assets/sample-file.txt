ORG 800H

START       
	CMC
	
GET_NUMBER
    LXI H,IN_PROMPT
    RST 3
    MVI C,0
	CALL GET_FIRST
	CALL GET_SECOND
	CALL GET_THIRD
	
	CALL CONVERT
	RET
GET_FIRST
	RST 2
	CALL VALIDATE_INPUT
	CALL GET_DEC
	
	MOV C,A
	RET
	
GET_SECOND
	RST 2
	CPI 0DH
	JZ CONVERT
	CALL VALIDATE_INPUT
	CALL GET_DEC
	
	MOV D,A
	MOV A,C
	CALL MULTIPLY_BY_10
	ADD D

	MOV C,A
	
	CALL CLEAR_CY
	CPI 1AH
	JNC CONVERT
	RET

GET_THIRD
	RST 2
	CPI 0DH
	JZ CONVERT
	CALL VALIDATE_INPUT
	CALL GET_DEC
	
	CALL CLEAR_CY
	CPI 06H
	JC GET_THIRD_FIN
	MOV D,A
	
	MOV A,C
	MVI B,18H
	CMP B
	JNC ERR
	MOV A,D
	CALL GET_THIRD_FIN
	RET
GET_THIRD_FIN
	MOV D,A
	MOV A,C
	CALL MULTIPLY_BY_10
	ADD D
	
	MOV C,A
	RET
	
MULTIPLY_BY_10
	RLC
	MOV B,A
	RLC
	RLC
	ADD B
	RET
	
VALIDATE_INPUT
	CALL CLEAR_CY
	CPI 30H
	JC ERR
	CPI 3AH
	JNC ERR
	RET	
	
CLEAR_CY
	STC
	CMC
	RET
	
GET_DEC
	MVI D,'0'
    SUB D
	RET
	
CONVERT
	CALL CONVERT_TO_BIN
    CALL CONVERT_TO_HEX
    CALL GET_NUMBER
	RET
CONVERT_TO_BIN     
    LXI H,BIN_PROMPT
    RST 3
    MVI B,8
    MOV E,C
PRINT_BITS  
    MOV A,E
    RLC
    MOV E,A
    JC BIT_1
BIT_0       
    MVI D,'0'
    JMP OUTPUT
BIT_1
	MVI D,'1'
OUTPUT      
    MOV A,D
    RST 1
    DCR B
    JNZ PRINT_BITS
    RET
CONVERT_TO_HEX 
	LXI H,HEX_PROMPT
	RST 3
	MOV A,C
	
	RLC
    RLC
    RLC
    RLC
    ANI 0Fh
            
    CALL NIBBLE_TO_ASCII
    CALL OUTCHAR
            
    MOV A,C
    ANI 0Fh
            
    CALL NIBBLE_TO_ASCII
    CALL OUTCHAR
    RET
NIBBLE_TO_ASCII
	CPI 0Ah
	JC LESS_THAN_10
	ADI 37h
	RET
LESS_THAN_10
	ADI 30h
	RET
OUTCHAR
    RST 1
    RET
	
ERR
	LXI H,ERR_PROMPT
	RST 3
	JMP START

END        HLT

IN_PROMPT  DB 10,13,'Enter decimal (0-255):@'
ERR_PROMPT DB 10,13,'Invalid input!@'
BIN_PROMPT DB 10,13,'Binary: @'
HEX_PROMPT DB 10,13,'Hex: @'